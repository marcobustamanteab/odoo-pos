<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="sql_export_consignment_sales_summary" model="sql.export">
            <field name="name">Resumen de ventas por consignación</field>
            <field name="file_format">excel</field>
            <field name="header">1</field>
            <field name="encoding">utf-8</field>
            <field name="field_ids" eval="[(6, 0, [ref('ir_model_fields_bus_unit_id'), ref('ir_model_fields_period')])]"/>
            <field name="query">
SELECT B.CCU_BUSINESS_UNIT AS SOCIEDAD, C.CODE AS TIPO_DTE
, A.SEQUENCE_NUMBER AS FOLIO, A.INVOICE_DATE AS FECHA_DTE
, D.VAT AS RUT_RECEPTOR, D.NAME AS RAZON_SOCIAL, A.REF AS REFERENCE
, A.AMOUNT_UNTAXED AS NETO

, COALESCE((SELECT SUM(ROUND(B.PRICE_SUBTOTAL * (D14.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE B
    LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C14 ON C14.ACCOUNT_MOVE_LINE_ID = B.ID
    JOIN ACCOUNT_TAX D14 ON D14.ID = C14.ACCOUNT_TAX_ID AND D14.L10N_CL_SII_CODE = 14
   WHERE B.MOVE_ID = A.ID
  ), 0) AS IVA

 , COALESCE((SELECT SUM(ROUND(B.PRICE_SUBTOTAL * (D24.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE B
    LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C24 ON C24.ACCOUNT_MOVE_LINE_ID = B.ID
    JOIN ACCOUNT_TAX D24 ON D24.ID = C24.ACCOUNT_TAX_ID AND D24.L10N_CL_SII_CODE = 24
   WHERE B.MOVE_ID = A.ID
  ), 0) AS IMPTO_24

, COALESCE((SELECT SUM(ROUND(B.PRICE_SUBTOTAL * (D25.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE B
    LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C25 ON C25.ACCOUNT_MOVE_LINE_ID = B.ID
    JOIN ACCOUNT_TAX D25 ON D25.ID = C25.ACCOUNT_TAX_ID AND D25.L10N_CL_SII_CODE = 25
   WHERE B.MOVE_ID = A.ID
  ), 0) AS IMPTO_25

  , COALESCE((SELECT SUM(ROUND(B.PRICE_SUBTOTAL * (D26.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE B
    LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C26 ON C26.ACCOUNT_MOVE_LINE_ID = B.ID
    JOIN ACCOUNT_TAX D26 ON D26.ID = C26.ACCOUNT_TAX_ID AND D26.L10N_CL_SII_CODE = 26
   WHERE B.MOVE_ID = A.ID
  ), 0) AS IMPTO_26

  , COALESCE((SELECT SUM(ROUND(B.PRICE_SUBTOTAL * (D27.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE B
    LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C27 ON C27.ACCOUNT_MOVE_LINE_ID = B.ID
    JOIN ACCOUNT_TAX D27 ON D27.ID = C27.ACCOUNT_TAX_ID AND D27.L10N_CL_SII_CODE = 27
   WHERE B.MOVE_ID = A.ID
  ), 0) AS IMPTO_27

  , COALESCE((SELECT SUM(ROUND(B.PRICE_SUBTOTAL * (D271.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE B
    LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C271 ON C271.ACCOUNT_MOVE_LINE_ID = B.ID
    JOIN ACCOUNT_TAX D271 ON D271.ID = C271.ACCOUNT_TAX_ID AND D271.L10N_CL_SII_CODE = 271
   WHERE B.MOVE_ID = A.ID
  ), 0) AS IMPTO_271

  , A.AMOUNT_TOTAL AS TOTAL

-- SELECT A.PRINCIPAL_COMPANY, *
FROM ACCOUNT_MOVE A
	LEFT JOIN RES_COMPANY B ON B.ID = A.COMPANY_ID
	LEFT JOIN L10N_LATAM_DOCUMENT_TYPE C ON C.ID = A.L10N_LATAM_DOCUMENT_TYPE_ID
	LEFT JOIN RES_PARTNER D ON D.ID = A.PARTNER_ID
WHERE A.MOVE_TYPE IN ('out_invoice', 'out_refund')
AND A.COMPANY_ID = (SELECT ID FROM RES_COMPANY WHERE CCU_BUSINESS_UNIT = %(x_bus_unit_id)s)
AND TO_CHAR(A.INVOICE_DATE, 'YYYY-MM') = %(x_period)s
AND A.PRINCIPAL_COMPANY IS NOT NULL
-- AND A.DATE BETWEEN TO_DATE(:DATE_FROM, 'YYYY-MM-DD') AND TO_DATE(:DATE_TO, 'YYYY-MM-DD')
ORDER BY B.CCU_BUSINESS_UNIT, A.INVOICE_DATE, C.CODE, A.SEQUENCE_NUMBER
            </field>
        </record>
        <record id="sql_export_consignment_sales_details" model="sql.export">
            <field name="name">Detalle de ventas por consignación</field>
            <field name="file_format">excel</field>
            <field name="header">1</field>
            <field name="encoding">utf-8</field>
            <field name="field_ids" eval="[(6, 0, [ref('ir_model_fields_bus_unit_id'), ref('ir_model_fields_period')])]"/>
            <field name="query">
SELECT B.CCU_BUSINESS_UNIT, B.NAME AS COMPANY, A.NAME AS INVOICE_REF
, C.CODE AS DOC_TYPE, A.INVOICE_DATE, D.VAT, D.NAME, G.DEFAULT_CODE AS PRODUCT_ID
, H.NAME, F.QUANTITY, F.PRICE_UNIT, F.PRICE_SUBTOTAL AS TOTAL_NETO
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D14.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C14
    JOIN ACCOUNT_TAX D14 ON D14.ID = C14.ACCOUNT_TAX_ID AND D14.L10N_CL_SII_CODE = 14
   WHERE C14.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IVA
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D24.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C24
    JOIN ACCOUNT_TAX D24 ON D24.ID = C24.ACCOUNT_TAX_ID AND D24.L10N_CL_SII_CODE = 24
   WHERE C24.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_24
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D25.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C25
    JOIN ACCOUNT_TAX D25 ON D25.ID = C25.ACCOUNT_TAX_ID AND D25.L10N_CL_SII_CODE = 25
   WHERE C25.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_25
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D26.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C26
    JOIN ACCOUNT_TAX D26 ON D26.ID = C26.ACCOUNT_TAX_ID AND D26.L10N_CL_SII_CODE = 26
   WHERE C26.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_26
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D27.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C27
    JOIN ACCOUNT_TAX D27 ON D27.ID = C27.ACCOUNT_TAX_ID AND D27.L10N_CL_SII_CODE = 27
   WHERE C27.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_27
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D271.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C271
    JOIN ACCOUNT_TAX D271 ON D271.ID = C271.ACCOUNT_TAX_ID AND D271.L10N_CL_SII_CODE = 271
   WHERE C271.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_271
, F.PRICE_TOTAL AS TOTAL_BRUTO
FROM ACCOUNT_MOVE A
 LEFT JOIN RES_COMPANY B ON B.ID = A.COMPANY_ID
 LEFT JOIN L10N_LATAM_DOCUMENT_TYPE C ON C.ID = A.L10N_LATAM_DOCUMENT_TYPE_ID
 LEFT JOIN RES_PARTNER D ON D.ID = A.PARTNER_ID
 LEFT JOIN POS_ORDER E ON E.ID = A.POS_ORDER_ID
 LEFT JOIN POS_SESSION L ON L.ID = A.POS_SESSION_ID
 LEFT JOIN POS_CONFIG M ON M.ID = L.CONFIG_ID
 LEFT JOIN RES_USERS N ON N.ID = A.CREATE_UID
 , ACCOUNT_MOVE_LINE F
 LEFT JOIN PRODUCT_PRODUCT G ON G.ID = F.PRODUCT_ID
 LEFT JOIN PRODUCT_TEMPLATE H ON H.ID = G.PRODUCT_TMPL_ID
 LEFT JOIN ACCOUNT_ACCOUNT I ON I.ID = F.ACCOUNT_ID
WHERE A.MOVE_TYPE IN ('out_invoice', 'out_refund')
AND A.COMPANY_ID = (SELECT ID FROM RES_COMPANY WHERE CCU_BUSINESS_UNIT = %(x_bus_unit_id)s)
AND TO_CHAR(A.DATE, 'YYYY-MM') = %(x_period)s
AND A.PRINCIPAL_COMPANY IS NOT NULL
 AND F.MOVE_ID = A.ID
 AND F.EXCLUDE_FROM_INVOICE_TAB IS FALSE
ORDER BY C.CODE, A.SEQUENCE_NUMBER, G.DEFAULT_CODE
            </field>
        </record>
        <record id="sql_export_sales_details" model="sql.export">
            <field name="name">Detalle de ventas</field>
            <field name="file_format">excel</field>
            <field name="header">1</field>
            <field name="encoding">utf-8</field>
            <field name="field_ids" eval="[(6, 0, [ref('ir_model_fields_bus_unit_id'), ref('ir_model_fields_period')])]"/>
            <field name="query">
SELECT B.CCU_BUSINESS_UNIT, B.NAME AS COMPANY, M.NAME AS CENTER, A.NAME AS INVOICE_REF, C.CODE AS DOC_TYPE, C.NAME AS DOC_NAME
, A.SEQUENCE_NUMBER, A.INVOICE_DATE, E.NAME AS POS_ORDER, D.VAT, D.NAME
, G.DEFAULT_CODE AS PRODUCT_ID, H.NAME, I.CCU_CODE AS ACCOUNT, F.QUANTITY, F.PRICE_UNIT, F.DISCOUNT AS DISCOUNT_PCT
, ROUND(F.PRICE_UNIT * F.QUANTITY, 0) AS MONTO_BASE_SIN_DESCUENTOS
, ROUND(F.PRICE_UNIT * F.QUANTITY * (F.DISCOUNT / 100), 0) AS MONTO_DESCUENTO
, F.PRICE_SUBTOTAL AS MONTO_BASE_CON_DESCUENTOS
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D14.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C14
    JOIN ACCOUNT_TAX D14 ON D14.ID = C14.ACCOUNT_TAX_ID AND D14.L10N_CL_SII_CODE = 14
   WHERE C14.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IVA
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D24.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C24
    JOIN ACCOUNT_TAX D24 ON D24.ID = C24.ACCOUNT_TAX_ID AND D24.L10N_CL_SII_CODE = 24
   WHERE C24.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_24
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D25.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C25
    JOIN ACCOUNT_TAX D25 ON D25.ID = C25.ACCOUNT_TAX_ID AND D25.L10N_CL_SII_CODE = 25
   WHERE C25.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_25
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D26.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C26
    JOIN ACCOUNT_TAX D26 ON D26.ID = C26.ACCOUNT_TAX_ID AND D26.L10N_CL_SII_CODE = 26
   WHERE C26.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_26
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D27.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C27
    JOIN ACCOUNT_TAX D27 ON D27.ID = C27.ACCOUNT_TAX_ID AND D27.L10N_CL_SII_CODE = 27
   WHERE C27.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_27
, COALESCE((SELECT SUM(ROUND(F.PRICE_SUBTOTAL * (D271.AMOUNT / 100), 0))
   FROM ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL C271
    JOIN ACCOUNT_TAX D271 ON D271.ID = C271.ACCOUNT_TAX_ID AND D271.L10N_CL_SII_CODE = 271
   WHERE C271.ACCOUNT_MOVE_LINE_ID = F.ID
  ), 0) AS IMPTO_271
, F.PRICE_TOTAL AS MONTO_CON_IMPUESTOS
, N.LOGIN
FROM ACCOUNT_MOVE A
 LEFT JOIN RES_COMPANY B ON B.ID = A.COMPANY_ID
 LEFT JOIN L10N_LATAM_DOCUMENT_TYPE C ON C.ID = A.L10N_LATAM_DOCUMENT_TYPE_ID
 LEFT JOIN RES_PARTNER D ON D.ID = A.PARTNER_ID
 LEFT JOIN POS_ORDER E ON E.ID = A.POS_ORDER_ID
 LEFT JOIN POS_SESSION L ON L.ID = A.POS_SESSION_ID
 LEFT JOIN POS_CONFIG M ON M.ID = L.CONFIG_ID
 LEFT JOIN RES_USERS N ON N.ID = A.CREATE_UID
 , ACCOUNT_MOVE_LINE F
 LEFT JOIN PRODUCT_PRODUCT G ON G.ID = F.PRODUCT_ID
 LEFT JOIN PRODUCT_TEMPLATE H ON H.ID = G.PRODUCT_TMPL_ID
 LEFT JOIN ACCOUNT_ACCOUNT I ON I.ID = F.ACCOUNT_ID
 LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL J1 ON J1.ACCOUNT_MOVE_LINE_ID = F.ID
 JOIN ACCOUNT_TAX K1 ON K1.ID = J1.ACCOUNT_TAX_ID AND K1.L10N_CL_SII_CODE = 14
 LEFT JOIN ACCOUNT_MOVE_LINE_ACCOUNT_TAX_REL J2 ON J2.ACCOUNT_MOVE_LINE_ID = F.ID
 JOIN ACCOUNT_TAX K2 ON K2.ID = J2.ACCOUNT_TAX_ID AND K2.L10N_CL_SII_CODE &lt;&gt; 14
WHERE A.COMPANY_ID = (SELECT ID FROM RES_COMPANY WHERE CCU_BUSINESS_UNIT = %(x_bus_unit_id)s )
 AND TO_CHAR(A.DATE, 'YYYY-MM') = %(x_period)s
 AND A.MOVE_TYPE IN ('out_invoice', 'out_refund')
 AND F.MOVE_ID = A.ID
 AND F.EXCLUDE_FROM_INVOICE_TAB IS FALSE
ORDER BY C.CODE, A.SEQUENCE_NUMBER, G.DEFAULT_CODE
            </field>
        </record>
    </data>
</odoo>